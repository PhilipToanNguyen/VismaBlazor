@page "/Generator"
@using Models
@inject VismaBlazor.HttpClientPost HttpClientPost
@inject NavigationManager NavigationManager
@using Microsoft.AspNetCore.Authorization
@using Radzen.Blazor;
@using Radzen;
@using System;
@rendermode @(new InteractiveServerRenderMode(prerender: false))
@attribute [StreamRendering]



<PageTitle>Generator</PageTitle>


<div>


    <RadzenCard class="text-center ">
        <div class="row">
            <div class="col-md-12 ">
                <div class=" d-inline-flex">
                    <div class=" pe-4">
                        <RadzenButton> Skriv inn liste med ID </RadzenButton>
                    </div>
                     
                    <div class=" ps-4">
                        <RadzenButton> Autogenerer antall ID </RadzenButton>
                    </div>
                </div>
            
                <div class="px-4">
                    <RadzenAlert Title="Skriv inn NøkkelID manuelt"
                        AlertStyle="AlertStyle.Info" 
                        Variant="Variant.Flat" 
                        Shade="Shade.Lighter"
                        AllowClose=false>
                        F.eks: 1,2,3,4 eller 3,8,16,3,1

                    </RadzenAlert>
                </div>
               
              
                <div class="p-4">        
                           <textarea 
                               id="generatormanuelt"
                               value="@flereids" @onchange="@((args) => flereids = args?.Value?.ToString())" 
                               class=" border-1 border rounded-3 shadow-sm w-100 h-50 "
                               rows="8" 
                               style="resize:none" 
                               placeholder=" F.eks: 1,3,6,20,11"   />    
                </div>

                <div class="px-4" >
                        <RadzenAlert Title="Skriv inn antall nøkler du ønsker å generere"          
                            AlertStyle="AlertStyle.Info" 
                            Variant="Variant.Flat" 
                            Shade="Shade.Lighter"
                            AllowClose=false>
                    </RadzenAlert>
                </div>


                <div class="col-md-12 p-2" >
                    <RadzenTextBox id="generatorantall" typeof="number" Value="@value" Change="@OnChange" Placeholder="Skriv antall brukere" style="width: 200px" />
                </div>

                <div class="col-md-12 p-2 text-center">                      
                         <RadzenButton id="genererKnapp" Text="Generer" ButtonStyle="ButtonStyle.Success" Click="@SendId" style="width: 25%" />
                </div>
              
            </div>
        </div>
    </RadzenCard>
</div>

@if (load == true)
{
    <RadzenAlert Text="Laster inn data" Severity="Severity.Info" AlertStyle="AlertStyle.Info" />
}

@if (error == true)
{
    <RadzenAlert Text="Vennligst skriv i ett av feltene" Severity="Severity.Warning" AlertStyle="AlertStyle.Danger" />
}

@code {


    private int ids;
    private string? flereids { get; set; }
    private string? value;
    private Boolean? error { get; set; }
    private Boolean load { get; set; }
    

    void OnChange(string value)
    {
        ids = int.Parse(value);

    }

    public IdList[]? idobject;

 

    private async Task SendId()
    {

        if (ids != 0 && flereids != null)
        {
            load = true;
            await HttpClientPost.Post(ids);
            await HttpClientPost.PostFlereId(flereids);
            
            NavigationManager.NavigateTo("/Resultat");
        }

        else if (ids != 0)
        {
            load = true;
            await HttpClientPost.Post(ids);  
            
            NavigationManager.NavigateTo("/Resultat");
        }

        else if (flereids != null)
        {
            load = true;
            await HttpClientPost.PostFlereId(flereids);
            
            NavigationManager.NavigateTo("/Resultat");
        }
   
        else 
        {
            error = true;
        }

      
}

    }

